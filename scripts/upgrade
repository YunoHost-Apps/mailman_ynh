#!/bin/bash

source /usr/share/yunohost/helpers

#=================================================
# MANAGE FAILURE OF THE SCRIPT
#=================================================

# Exit if an error occurs during the execution of the script
ynh_abort_if_errors


app=$YNH_APP_INSTANCE_NAME
is_public=$(ynh_app_setting_get --app=$app --key=is_public)


#=================================================
# Fix legacy settings (old unprotected_regex)
#=================================================

ynh_app_setting_delete --app=$app --key=unprotected_regex

[ "$is_public" -eq 0 ] || ynh_app_setting_set "$app" unprotected_uris "/"
ynh_app_setting_set "$app" protected_uris "/admin"

